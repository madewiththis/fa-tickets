(()=>{var e={};e.id=772,e.ids=[772],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8719:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>l}),s(641),s(6487),s(5866);var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),o=s(5231),c={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);s.d(t,c);let l=["",{children:["pay",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,641)),"/Volumes/Data/Coding Data/fa-tickets/web/app/pay/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6487)),"/Volumes/Data/Coding Data/fa-tickets/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Volumes/Data/Coding Data/fa-tickets/web/app/pay/page.tsx"],m="/pay/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/pay/page",pathname:"/pay",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},9434:(e,t,s)=>{Promise.resolve().then(s.bind(s,7651)),Promise.resolve().then(s.bind(s,3438))},9860:(e,t,s)=>{Promise.resolve().then(s.bind(s,5206)),Promise.resolve().then(s.bind(s,1967))},2991:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},5206:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(326),r=s(7577),n=s(5137),i=s(5077);function o({purchase:e}){let[t,s]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),[l,d]=(0,r.useState)(""),[m,u]=(0,r.useState)(Date.now()),h=(0,r.useMemo)(()=>{let t=new Map;for(let s of e.tickets||[]){let e=`${s.type_name||s.type_id}-${s.price_baht||0}`,a=t.get(e)||{name:s.type_name||`Type #${s.type_id}`,price:s.price_baht||0,qty:0,subtotal:0};a.qty+=1,a.subtotal+=a.price,t.set(e,a)}return Array.from(t.values())},[e]),p=(0,r.useMemo)(()=>"number"==typeof e.total_amount?e.total_amount:"number"==typeof e.sum_price?e.sum_price:h.reduce((e,t)=>e+t.subtotal,0),[e,h]),y=e.currency||"THB",x=(0,r.useMemo)(()=>{let t=e.created_at?new Date(e.created_at).getTime():0,s=t?t+864e5:0,a=Math.max(0,Math.floor((s-m)/1e3)),r=Math.floor(a/86400);return s?`${r>0?r+"d ":""}${Math.floor(a%86400/3600)}h ${Math.floor(a%3600/60)}m`:""},[e,m]);async function f(){try{s(!0),d(""),await n.h.payPurchase(e.id),c(!0)}catch(e){d(e?.message||"Payment failed")}finally{s(!1)}}return a.jsx("div",{className:"space-y-3",children:o?a.jsx("div",{className:"p-4 border rounded text-sm",children:"Payment successful. Tickets will arrive by email shortly."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Reservation expires in ",x]}),a.jsx("div",{className:"border rounded",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{className:"text-left border-b",children:[a.jsx("th",{className:"p-2",children:"Item"}),a.jsx("th",{className:"p-2",children:"Qty"}),a.jsx("th",{className:"p-2",children:"Price"}),a.jsx("th",{className:"p-2",children:"Subtotal"})]})}),a.jsx("tbody",{children:h.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b last:border-b-0",children:[a.jsx("td",{className:"p-2",children:e.name}),a.jsx("td",{className:"p-2",children:e.qty}),a.jsx("td",{className:"p-2",children:(0,i.dN)(e.price,y)}),a.jsx("td",{className:"p-2",children:(0,i.dN)(e.subtotal,y)})]},t))})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-base font-medium",children:["Total: ",(0,i.dN)(p,y)]}),a.jsx("button",{onClick:f,disabled:t,className:"px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:t?"Paying…":"Pay now"})]}),l&&a.jsx("div",{className:"text-sm text-red-600",children:l})]})})}},1967:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var a=s(326),r=s(7577),n=s(5137);function i({token:e,ticket:t}){let[s,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),[l,d]=(0,r.useState)("");async function m(){try{i(!0),d(""),await n.h.payByToken(e),c(!0)}catch(e){d(e?.message||"Payment failed")}finally{i(!1)}}return a.jsx("div",{className:"space-y-3",children:o?a.jsx("div",{className:"p-4 border rounded text-sm",children:"Payment successful. Ticket will arrive by email shortly."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-sm",children:["Ticket: ",t?.type_name||t?.type_id||"—"]}),a.jsx("button",{onClick:m,disabled:s,className:"px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:s?"Paying…":"Pay now"}),l&&a.jsx("div",{className:"text-sm text-red-600",children:l})]})})}},7651:(e,t,s)=>{"use strict";s.d(t,{TopNav:()=>c});var a=s(326),r=s(434),n=s(5047),i=s(4831);function o(){let{resolvedTheme:e,setTheme:t}=(0,i.F)(),s="Toggle theme";return a.jsx("button",{type:"button","aria-label":s,title:s,onClick:function(){t("dark"==("dark"===e?"dark":"light")?"light":"dark")},className:"px-2 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:"Theme"})}function c(){let e=(0,n.usePathname)(),t=t=>e===t||e.startsWith(t+"/"),s=e=>(function(...e){return e.filter(Boolean).join(" ")})("px-3 py-1 rounded border inline-flex items-center gap-1",e?"bg-gray-900 text-white dark:bg-white dark:text-black":"hover:bg-gray-100 dark:hover:bg-gray-800");return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"FlowEvents"}),a.jsx("div",{className:"ml-auto flex items-center gap-2",children:a.jsx(o,{})})]}),(0,a.jsxs)("nav",{className:"mb-8 hidden sm:flex flex-wrap gap-2",children:[a.jsx(r.default,{href:"/events",className:s(t("/events")),children:"Events"}),a.jsx(r.default,{href:"/attendees",className:s(t("/attendees")),children:"Tickets"}),a.jsx(r.default,{href:"/content",className:s(t("/content")),children:"Content"}),a.jsx(r.default,{href:"/checkin",className:s(t("/checkin")),children:"Check in"}),a.jsx(r.default,{href:"/reports",className:s(t("/reports")),children:"Reports"}),a.jsx(r.default,{href:"/admin/email-logs",className:s(t("/admin")),children:"App Admin"})]})]})}},3438:(e,t,s)=>{"use strict";s.d(t,{ThemeProvider:()=>n});var a=s(326),r=s(4831);function n({children:e,...t}){return a.jsx(r.f,{attribute:"class",defaultTheme:"system",enableSystem:!0,...t,children:e})}},5137:(e,t,s)=>{"use strict";s.d(t,{h:()=>i});let a=process.env.NEXT_PUBLIC_API_TOKEN,r=process.env.BACKEND_ORIGIN||"/api";async function n(e,t){let s={"Content-Type":"application/json",...t?.headers||{}};a&&(s["X-Auth-Token"]=a);let n=await fetch(`${r}${e}`,{headers:s,...t,cache:"no-store"});if(!n.ok){let e=`${n.status} ${n.statusText}`;try{let t=await n.json();t?.detail&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch{}throw Error(e)}if(204!==n.status)return n.json()}let i={listEvents:(e=50,t=0)=>n(`/events?limit=${e}&offset=${t}`),resolveEvent:e=>n(`/events/public/${encodeURIComponent(e)}`),getEvent:e=>n(`/events/${e}`),createEvent:e=>n("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>n(`/events/${e}`,{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>n(`/events/${e}/ticket_types`),createTicketType:(e,t)=>n(`/events/${e}/ticket_types`,{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>n(`/events/ticket_types/${e}`,{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>n(`/reports/reconciliation?event_id=${e}`),listEventPurchases:e=>n(`/events/${e}/purchases`),listAttendees:e=>n(`/events/${e}/attendees`),getPurchase:e=>n(`/purchases/${e}`),getPurchaseByGuid:e=>n(`/purchases/by-guid/${encodeURIComponent(e)}`),payPurchase:e=>n(`/purchases/${e}/pay`,{method:"POST"}),resendPurchasePayment:e=>n(`/purchases/${e}/resend_payment`,{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;e?.search&&t.set("search",e.search),e?.roles&&t.set("roles",e.roles),e?.limit!=null&&t.set("limit",String(e.limit)),e?.offset!=null&&t.set("offset",String(e.offset));let s=t.toString()?`?${t.toString()}`:"";return n(`/contacts${s}`)},getContact:e=>n(`/contacts/${e}`),listContactPurchases:(e,t)=>n(`/contacts/${e}/purchases${t?`?event_id=${t}`:""}`),listHolderTickets:e=>n(`/contacts/${e}/holder_tickets`),ticketByCode:e=>n(`/tickets/by-code/${encodeURIComponent(e)}`),ticketByToken:e=>n(`/tickets/by-token/${encodeURIComponent(e)}`),payByToken:e=>n("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>n(`/tickets/lookup?code=${encodeURIComponent(e)}${t?`&event_id=${t}`:""}`),checkin:(e,t)=>n("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:(e=50,t=0)=>n(`/admin/email_logs?limit=${e}&offset=${t}`),sendTestEmail:e=>n(`/test_email?to=${encodeURIComponent(e)}`,{method:"POST"}),qrUrl:(e,t=5)=>`${r}/qr?data=${encodeURIComponent(e)}&scale=${t}`}},5077:(e,t,s)=>{"use strict";function a(e,t){if(null==e||isNaN(e))return"—";if("THB"===(t||"").toUpperCase()){var s;return null==(s=Number(e))||isNaN(s)?"-":new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",maximumFractionDigits:0}).format(Number(s))}let a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Number(e));return t?`${a} ${t}`:a}function r(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getFullYear()).slice(-2);return`${s}/${a}/${r}`}s.d(t,{GZ:()=>r,dN:()=>a})},6487:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p,metadata:()=>h});var a=s(9510);s(7272);var r=s(8570);let n=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/src/components/providers/theme.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let c=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/src/components/providers/theme.tsx#ThemeProvider`),l=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/src/components/layout/TopNav.tsx`),{__esModule:d,$$typeof:m}=l;l.default;let u=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/src/components/layout/TopNav.tsx#TopNav`),h={title:"FlowEvents"};function p({children:e}){return a.jsx("html",{lang:"en",suppressHydrationWarning:!0,children:a.jsx("body",{children:a.jsx(c,{children:(0,a.jsxs)("div",{className:"container mx-auto max-w-5xl p-4",children:[a.jsx(u,{}),a.jsx("div",{className:"min-h-[60vh]",children:e})]})})})})}},641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(9510),r=s(8570);let n=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/app/pay/PayPurchaseClient.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let c=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/app/pay/PayPurchaseClient.tsx#default`),l=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/app/pay/PayTokenClient.tsx`),{__esModule:d,$$typeof:m}=l;l.default;let u=(0,r.createProxy)(String.raw`/Volumes/Data/Coding Data/fa-tickets/web/app/pay/PayTokenClient.tsx#default`);var h=s(3248);async function p({searchParams:e}){let t=(e?.purchase||"").trim(),s=(e?.token||"").trim();if(t){let e=null;try{e=await h.h.getPurchaseByGuid(t)}catch(e){return(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["Failed to load purchase: ",e?.message||"Unknown error"]})}return(0,a.jsxs)("section",{className:"space-y-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Purchase Payment"}),a.jsx(c,{purchase:e})]})}if(s){let e=null;try{e=await h.h.ticketByToken(s)}catch(e){return(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["Failed to load ticket: ",e?.message||"Unknown error"]})}return(0,a.jsxs)("section",{className:"space-y-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Ticket Payment"}),a.jsx(u,{token:s,ticket:e})]})}return(0,a.jsxs)("section",{className:"space-y-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Payment"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Provide a purchase GUID (?purchase=GUID) or ticket token (?token=TOKEN)."})]})}},3248:(e,t,s)=>{"use strict";s.d(t,{h:()=>i});let a=process.env.NEXT_PUBLIC_API_TOKEN,r=process.env.BACKEND_ORIGIN||"/api";async function n(e,t){let s={"Content-Type":"application/json",...t?.headers||{}};a&&(s["X-Auth-Token"]=a);let n=await fetch(`${r}${e}`,{headers:s,...t,cache:"no-store"});if(!n.ok){let e=`${n.status} ${n.statusText}`;try{let t=await n.json();t?.detail&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch{}throw Error(e)}if(204!==n.status)return n.json()}let i={listEvents:(e=50,t=0)=>n(`/events?limit=${e}&offset=${t}`),resolveEvent:e=>n(`/events/public/${encodeURIComponent(e)}`),getEvent:e=>n(`/events/${e}`),createEvent:e=>n("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>n(`/events/${e}`,{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>n(`/events/${e}/ticket_types`),createTicketType:(e,t)=>n(`/events/${e}/ticket_types`,{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>n(`/events/ticket_types/${e}`,{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>n(`/reports/reconciliation?event_id=${e}`),listEventPurchases:e=>n(`/events/${e}/purchases`),listAttendees:e=>n(`/events/${e}/attendees`),getPurchase:e=>n(`/purchases/${e}`),getPurchaseByGuid:e=>n(`/purchases/by-guid/${encodeURIComponent(e)}`),payPurchase:e=>n(`/purchases/${e}/pay`,{method:"POST"}),resendPurchasePayment:e=>n(`/purchases/${e}/resend_payment`,{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;e?.search&&t.set("search",e.search),e?.roles&&t.set("roles",e.roles),e?.limit!=null&&t.set("limit",String(e.limit)),e?.offset!=null&&t.set("offset",String(e.offset));let s=t.toString()?`?${t.toString()}`:"";return n(`/contacts${s}`)},getContact:e=>n(`/contacts/${e}`),listContactPurchases:(e,t)=>n(`/contacts/${e}/purchases${t?`?event_id=${t}`:""}`),listHolderTickets:e=>n(`/contacts/${e}/holder_tickets`),ticketByCode:e=>n(`/tickets/by-code/${encodeURIComponent(e)}`),ticketByToken:e=>n(`/tickets/by-token/${encodeURIComponent(e)}`),payByToken:e=>n("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>n(`/tickets/lookup?code=${encodeURIComponent(e)}${t?`&event_id=${t}`:""}`),checkin:(e,t)=>n("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:(e=50,t=0)=>n(`/admin/email_logs?limit=${e}&offset=${t}`),sendTestEmail:e=>n(`/test_email?to=${encodeURIComponent(e)}`,{method:"POST"}),qrUrl:(e,t=5)=>`${r}/qr?data=${encodeURIComponent(e)}&scale=${t}`}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948],()=>s(8719));module.exports=a})();