(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[529],{2017:function(e,t,n){Promise.resolve().then(n.bind(n,6047))},6047:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var c=n(7437),r=n(2265),s=n(1013);function o(){let[e,t]=(0,r.useState)(""),[n,o]=(0,r.useState)(""),[a,i]=(0,r.useState)(""),[l,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)([]),[f,p]=(0,r.useState)([]),[m,y]=(0,r.useState)(!1),[v,g]=(0,r.useState)(!1),[x,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{u(!0);try{h(await s.h.listEvents(200,0))}finally{u(!1)}})()},[]);let b=(0,r.useMemo)(()=>{let e=new Date;return(Array.isArray(d)?d:[]).filter(t=>{let n=t.starts_at?new Date(t.starts_at):null,c=t.ends_at?new Date(t.ends_at):null;return c?c>=e:!!n&&n>=e})},[d]);(0,r.useEffect)(()=>{(async()=>{if(p([]),e)try{p(await s.h.listAttendees(Number(e)))}catch(e){}})()},[e]),(0,r.useEffect)(()=>{(async()=>{if(y(!1),k(!1),e&&3===n.length)try{await s.h.lookupTicket(n,Number(e)),y(!0)}catch(e){y(!1)}})()},[n,e]);let T=(0,r.useMemo)(()=>{let e=n.trim().toUpperCase();return f.find(t=>(t.short_code||"").toUpperCase()===e)},[f,n]),N=!!(T&&T.checked_in_at);async function j(){if(e&&3===n.length&&m){g(!0),i("");try{await s.h.checkin(Number(e),n),k(!0),setTimeout(()=>{k(!1),o(""),y(!1)},500)}catch(e){i((null==e?void 0:e.message)||"Failed to check in")}finally{g(!1)}}}return(0,c.jsxs)("section",{className:"space-y-4",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold",children:"Check in"}),(0,c.jsxs)("div",{className:"grid gap-3 max-w-sm",children:[(0,c.jsxs)("select",{value:e?String(e):"",onChange:e=>t(e.target.value?Number(e.target.value):""),className:"px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900",children:[(0,c.jsx)("option",{value:"",children:l?"Loading…":"Select event…"}),b.map(e=>(0,c.jsxs)("option",{value:String(e.id),children:["#",e.id," • ",e.title]},e.id))]}),e?(0,c.jsxs)("div",{className:"border rounded p-3 space-y-3",children:[(0,c.jsx)("div",{className:"flex items-center gap-2",children:(0,c.jsx)("input",{inputMode:"text",pattern:"[0-9A-Za-z]{3}",maxLength:3,value:n,onChange:e=>o(e.target.value.toUpperCase().slice(0,3)),placeholder:"Enter code",className:"flex-1 text-center text-3xl tracking-[0.6em] h-16 border rounded",autoFocus:!0})}),3===n.length&&(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"".concat(m?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"," text-base font-semibold"),children:[m?"Code is valid":"Code not found for this event",m&&N?" — already checked in":""]}),T&&(0,c.jsxs)("div",{className:"text-sm grid gap-1",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Ticket No.:"})," ",T.ticket_number||"—"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"})," ",[T.first_name,T.last_name].filter(Boolean).join(" ")||"—"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Email:"})," ",T.email||"—"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Phone:"})," ",T.phone||"—"]})]}),(0,c.jsx)("div",{children:m?N?(0,c.jsx)("button",{onClick:()=>{o(""),i("")},className:"w-full px-3 py-2 border rounded text-sm",children:"OK"}):x?(0,c.jsx)("button",{className:"w-full px-3 py-2 border rounded text-sm bg-green-600 text-white",disabled:!0,children:"User has been checked in"}):(0,c.jsx)("button",{onClick:j,disabled:v,className:"w-full px-3 py-2 border rounded text-sm",children:v?"Checking in…":"Check in"}):(0,c.jsx)("button",{onClick:()=>o(""),className:"w-full px-3 py-2 border rounded text-sm",children:"Clear"})})]})]}):null,a&&(0,c.jsx)("p",{className:"text-sm text-red-600",children:a})]})]})}},357:function(e,t,n){"use strict";var c,r;e.exports=(null==(c=n.g.process)?void 0:c.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,c,r=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var i=[],l=!1,u=-1;function d(){l&&c&&(l=!1,c.length?i=c.concat(i):u=-1,i.length&&h())}function h(){if(!l){var e=a(d);l=!0;for(var t=i.length;t;){for(c=i,i=[];++u<t;)c&&c[u].run();u=-1,t=i.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new f(e,t)),1!==i.length||l||a(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function c(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}},o=!0;try{t[e](s,s.exports,c),o=!1}finally{o&&delete n[e]}return s.exports}c.ab="//";var r=c(229);e.exports=r}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var c=n(357);let r="/api",s=c.env.NEXT_PUBLIC_API_TOKEN;async function o(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};s&&(n["X-Auth-Token"]=s);let c=await fetch("".concat(r).concat(e),{headers:n,...t,cache:"no-store"});if(!c.ok){let e="".concat(c.status," ").concat(c.statusText);try{let t=await c.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==c.status)return c.json()}c.env.BACKEND_ORIGIN;let a={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>o("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>o("/events/".concat(e)),createEvent:e=>o("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>o("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>o("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>o("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>o("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>o("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>o("/events/".concat(e,"/purchases")),listAttendees:e=>o("/events/".concat(e,"/attendees")),getPurchase:e=>o("/purchases/".concat(e)),getPurchaseByGuid:e=>o("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>o("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>o("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return o("/contacts".concat(n))},getContact:e=>o("/contacts/".concat(e)),listContactPurchases:(e,t)=>o("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>o("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>o("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>o("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>o("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>o("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>o("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>o("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(r,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=2017)}),_N_E=e.O()}]);