(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{1304:function(e,t,n){Promise.resolve().then(n.bind(n,2133))},2133:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var s=n(7437),c=n(2265),a=n(1013);function r(){let[e,t]=(0,c.useState)([]),[n,r]=(0,c.useState)(!1),[o,i]=(0,c.useState)(""),[l,d]=(0,c.useState)(""),[u,h]=(0,c.useState)("");async function m(){r(!0),i("");try{let e=await a.h.listEmailLogs(100,0);t(e)}catch(e){i(e.message||"Failed to load logs")}finally{r(!1)}}(0,c.useEffect)(()=>{m()},[]);let p=(0,c.useMemo)(()=>{let t=l.trim().toLowerCase();return t?e.filter(e=>[e.to_email,e.template_name,e.subject,e.status,e.text_body].map(e=>String(e||"").toLowerCase()).join(" ").includes(t)):e},[e,l]);return(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Email Logs"}),(0,s.jsx)("button",{onClick:m,disabled:n,className:"px-2 py-1 border rounded text-sm",children:n?"Refreshing…":"Refresh"})]}),o&&(0,s.jsx)("div",{className:"text-sm text-red-600",children:o}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("input",{placeholder:"Filter…",value:l,onChange:e=>d(e.target.value),className:"max-w-xs px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)("input",{placeholder:"Email address",value:u,onChange:e=>h(e.target.value),className:"max-w-xs px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"}),(0,s.jsx)("button",{onClick:async()=>{if(!u.includes("@")){alert("Enter a valid email");return}try{await a.h.sendTestEmail(u),alert("Test email sent"),m()}catch(e){alert((null==e?void 0:e.message)||"Send failed"),m()}},className:"px-3 py-2 border rounded text-sm",children:"Send test email"})]})]}),(0,s.jsx)("div",{className:"border rounded overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left border-b",children:[(0,s.jsx)("th",{className:"p-2",children:"Time"}),(0,s.jsx)("th",{className:"p-2",children:"To"}),(0,s.jsx)("th",{className:"p-2",children:"Template"}),(0,s.jsx)("th",{className:"p-2",children:"Subject"}),(0,s.jsx)("th",{className:"p-2",children:"Status"}),(0,s.jsx)("th",{className:"p-2",children:"Refs"}),(0,s.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,s.jsxs)("tbody",{children:[p.map(e=>(0,s.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,s.jsx)("td",{className:"p-2 text-xs text-gray-600 dark:text-gray-400",children:new Date(e.created_at).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-xs",children:e.to_email}),(0,s.jsx)("td",{className:"p-2 text-xs",children:e.template_name}),(0,s.jsx)("td",{className:"p-2 text-xs",children:e.subject}),(0,s.jsx)("td",{className:"p-2 text-xs capitalize",children:e.status}),(0,s.jsx)("td",{className:"p-2 text-xs text-gray-600 dark:text-gray-400",children:[e.event_id&&"ev:".concat(e.event_id),e.ticket_id&&"t:".concat(e.ticket_id),e.purchase_id&&"p:".concat(e.purchase_id)].filter(Boolean).join(" \xb7 ")}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("button",{onClick:async()=>{try{let t={id:e.id,created_at:e.created_at,to_email:e.to_email,subject:e.subject,template_name:e.template_name,status:e.status,event_id:e.event_id,ticket_id:e.ticket_id,purchase_id:e.purchase_id,context:e.context||{},text_body:e.text_body||""};await navigator.clipboard.writeText(JSON.stringify(t,null,2)),alert("Copied email JSON")}catch(e){alert((null==e?void 0:e.message)||"Copy failed")}},className:"px-2 py-1 border rounded text-sm",children:"Copy"})})]},e.id)),0===p.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-4 text-gray-500",colSpan:7,children:"No email logs."})})]})]})})]})}},357:function(e,t,n){"use strict";var s,c;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(c=n.g.process)?void 0:c.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,s,c=e.exports={};function a(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var i=[],l=!1,d=-1;function u(){l&&s&&(l=!1,s.length?i=s.concat(i):d=-1,i.length&&h())}function h(){if(!l){var e=o(u);l=!0;for(var t=i.length;t;){for(s=i,i=[];++d<t;)s&&s[d].run();d=-1,t=i.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}c.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new m(e,t)),1!==i.length||l||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=p,c.addListener=p,c.once=p,c.off=p,c.removeListener=p,c.removeAllListeners=p,c.emit=p,c.prependListener=p,c.prependOnceListener=p,c.listeners=function(e){return[]},c.binding=function(e){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw Error("process.chdir is not supported")},c.umask=function(){return 0}}},n={};function s(e){var c=n[e];if(void 0!==c)return c.exports;var a=n[e]={exports:{}},r=!0;try{t[e](a,a.exports,s),r=!1}finally{r&&delete n[e]}return a.exports}s.ab="//";var c=s(229);e.exports=c}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var s=n(357);let c="/api",a=s.env.NEXT_PUBLIC_API_TOKEN;async function r(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};a&&(n["X-Auth-Token"]=a);let s=await fetch("".concat(c).concat(e),{headers:n,...t,cache:"no-store"});if(!s.ok){let e="".concat(s.status," ").concat(s.statusText);try{let t=await s.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==s.status)return s.json()}s.env.BACKEND_ORIGIN;let o={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>r("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>r("/events/".concat(e)),createEvent:e=>r("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>r("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>r("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>r("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>r("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>r("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>r("/events/".concat(e,"/purchases")),listAttendees:e=>r("/events/".concat(e,"/attendees")),getPurchase:e=>r("/purchases/".concat(e)),getPurchaseByGuid:e=>r("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>r("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>r("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return r("/contacts".concat(n))},getContact:e=>r("/contacts/".concat(e)),listContactPurchases:(e,t)=>r("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>r("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>r("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>r("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>r("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>r("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>r("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>r("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(c,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=1304)}),_N_E=e.O()}]);