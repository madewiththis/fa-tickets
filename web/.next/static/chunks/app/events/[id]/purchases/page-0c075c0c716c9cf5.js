(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{6226:function(e,t,n){Promise.resolve().then(n.bind(n,6256))},6256:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var r=n(7437),c=n(2265),a=n(4621),i=n(1013);function s(e){let t=e.paid_count||0,n=e.unpaid_count||0,r=e.waived_count||0;return t>0&&0===n&&0===r?"paid":0===t&&n>0&&0===r?"unpaid":0===t&&0===n&&r>0?"waived":"mixed"}function o(e){let{rows:t,eventId:n}=e,[o,l]=(0,c.useState)(""),[u,d]=(0,c.useState)("all"),[h,m]=(0,c.useState)(null),[p,f]=(0,c.useState)({}),y=(0,c.useMemo)(()=>{let e=o.trim().toLowerCase();return t.filter(t=>{if("all"!==u&&s(t)!==u)return!1;if(!e)return!0;let n=t.buyer||{};return[t.id,t.external_payment_ref,t.currency,n.email,n.first_name,n.last_name].some(t=>String(t||"").toLowerCase().includes(e))})},[t,o,u]);async function v(e){try{m(e),await i.h.resendPurchasePayment(e),f(t=>({...t,[e]:!0}))}catch(e){alert((null==e?void 0:e.message)||"Failed to resend payment link")}finally{m(null)}}return(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Search"}),(0,r.jsx)("input",{value:o,onChange:e=>l(e.target.value),placeholder:"Purchase id, ref, buyer…",className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"})]}),(0,r.jsxs)("div",{className:"w-48",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Payment status"}),(0,r.jsxs)("select",{value:u,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900",children:[(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"unpaid",children:"Unpaid"}),(0,r.jsx)("option",{value:"paid",children:"Paid"}),(0,r.jsx)("option",{value:"waived",children:"Waived"}),(0,r.jsx)("option",{value:"mixed",children:"Mixed"})]})]})]}),(0,r.jsx)("div",{className:"border rounded",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-left border-b",children:[(0,r.jsx)("th",{className:"p-2",children:"Name"}),(0,r.jsx)("th",{className:"p-2",children:"Email"}),(0,r.jsx)("th",{className:"p-2",children:"Tickets"}),(0,r.jsx)("th",{className:"p-2",children:"Amount"}),(0,r.jsx)("th",{className:"p-2",children:"Payment Status"}),(0,r.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[y.map(e=>{let t=e.buyer||{},n=[t.first_name,t.last_name].filter(Boolean).join(" ")||"—",c=t.email||"—",i=s(e),o=null!=e.total_amount?e.total_amount:null!=e.sum_price?e.sum_price:0,l=(0,a.dN)(o,e.currency||"THB"),u=(e.paid_count||0)+(e.unpaid_count||0)+(e.waived_count||0);return(0,r.jsxs)("tr",{className:"border-b last:border-b-0 hover:bg-gray-50 dark:hover:bg-gray-800/40",children:[(0,r.jsx)("td",{className:"p-2",children:n}),(0,r.jsx)("td",{className:"p-2",children:c}),(0,r.jsx)("td",{className:"p-2",children:u}),(0,r.jsx)("td",{className:"p-2",children:l}),(0,r.jsx)("td",{className:"p-2 capitalize",children:i}),(0,r.jsx)("td",{className:"p-2",children:"unpaid"===i?(0,r.jsx)("button",{disabled:h===e.id,onClick:()=>v(e.id),className:"px-2 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:p[e.id]?"Sent":h===e.id?"Sending…":"Resend payment link"}):(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"—"})})]},e.id)}),0===y.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"p-4 text-gray-500",colSpan:6,children:"No purchases found."})})]})]})})]})}},357:function(e,t,n){"use strict";var r,c;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(c=n.g.process)?void 0:c.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,c=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var o=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?o=r.concat(o):u=-1,o.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}c.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new m(e,t)),1!==o.length||l||s(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=p,c.addListener=p,c.once=p,c.off=p,c.removeListener=p,c.removeAllListeners=p,c.emit=p,c.prependListener=p,c.prependOnceListener=p,c.listeners=function(e){return[]},c.binding=function(e){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw Error("process.chdir is not supported")},c.umask=function(){return 0}}},n={};function r(e){var c=n[e];if(void 0!==c)return c.exports;var a=n[e]={exports:{}},i=!0;try{t[e](a,a.exports,r),i=!1}finally{i&&delete n[e]}return a.exports}r.ab="//";var c=r(229);e.exports=c}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var r=n(357);let c="/api",a=r.env.NEXT_PUBLIC_API_TOKEN;async function i(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};a&&(n["X-Auth-Token"]=a);let r=await fetch("".concat(c).concat(e),{headers:n,...t,cache:"no-store"});if(!r.ok){let e="".concat(r.status," ").concat(r.statusText);try{let t=await r.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==r.status)return r.json()}r.env.BACKEND_ORIGIN;let s={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>i("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>i("/events/".concat(e)),createEvent:e=>i("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>i("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>i("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>i("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>i("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>i("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>i("/events/".concat(e,"/purchases")),listAttendees:e=>i("/events/".concat(e,"/attendees")),getPurchase:e=>i("/purchases/".concat(e)),getPurchaseByGuid:e=>i("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>i("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>i("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return i("/contacts".concat(n))},getContact:e=>i("/contacts/".concat(e)),listContactPurchases:(e,t)=>i("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>i("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>i("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>i("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>i("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>i("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>i("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>i("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(c,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}},4621:function(e,t,n){"use strict";function r(e,t){if(null==e||isNaN(e))return"—";if("THB"===(t||"").toUpperCase()){var n;return null==(n=Number(e))||isNaN(n)?"-":new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",maximumFractionDigits:0}).format(Number(n))}let r=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Number(e));return t?"".concat(r," ").concat(t):r}function c(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let n=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getFullYear()).slice(-2);return"".concat(n,"/").concat(r,"/").concat(c)}n.d(t,{GZ:function(){return c},dN:function(){return r}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6226)}),_N_E=e.O()}]);