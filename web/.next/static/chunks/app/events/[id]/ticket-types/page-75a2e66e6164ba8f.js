(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{9414:function(e,t,n){Promise.resolve().then(n.bind(n,427))},427:function(e,t,n){"use strict";n.d(t,{default:function(){return c}});var a=n(7437),r=n(2265),i=n(1013),s=n(4621);function c(e){var t;let{eventId:n,initialTypes:c}=e,[o,l]=(0,r.useState)(c||[]),[u,d]=(0,r.useState)(!1),[m,h]=(0,r.useState)({name:"",price_baht:0,max_quantity:null,active:!0}),[p,y]=(0,r.useState)(null),[x,v]=(0,r.useState)(""),[g,f]=(0,r.useState)(null),[b,N]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{N(await i.h.listAttendees(n))}catch(e){}})()},[n]);let j=(0,r.useMemo)(()=>{let e={};for(let t of b||[]){let n=t.ticket_type_id;n&&(e[n]||(e[n]={issued:0,paid:0}),e[n].issued+=1,"paid"===t.payment_status&&(e[n].paid+=1))}return e},[b]);async function k(){try{var e,t;if(y("new"),v(""),!(null===(e=m.name)||void 0===e?void 0:e.trim()))throw Error("Name is required");let a={name:null===(t=m.name)||void 0===t?void 0:t.trim(),price_baht:Number(m.price_baht)||0,max_quantity:null!=m.max_quantity&&""!==m.max_quantity?Number(m.max_quantity):null,active:!!m.active},r=await i.h.createTicketType(n,a);l(e=>[...e,r]),d(!1),h({name:"",price_baht:0,max_quantity:null,active:!0})}catch(e){v((null==e?void 0:e.message)||"Create failed")}finally{y(null)}}async function _(e,t){let n={...e,...t};l(t=>t.map(t=>t.id===e.id?n:t))}async function T(e){try{y(e.id),v("");let t={name:e.name,price_baht:Number(e.price_baht)||0,max_quantity:null!=e.max_quantity&&""!==e.max_quantity?Number(e.max_quantity):null,active:!!e.active},n=await i.h.updateTicketType(e.id,t);l(t=>t.map(t=>t.id===e.id?n:t))}catch(e){v((null==e?void 0:e.message)||"Save failed")}finally{y(null)}}return(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 justify-end",children:(0,a.jsx)("button",{onClick:()=>d(e=>!e),className:"ml-auto px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:u?"Cancel":"New Ticket Type"})}),x&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:x}),u&&(0,a.jsxs)("div",{className:"border rounded p-3 grid gap-2 md:grid-cols-[2fr_1fr_1fr_1fr_auto] items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Name"}),(0,a.jsx)("input",{value:m.name,onChange:e=>h(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Price (THB)"}),(0,a.jsx)("input",{type:"number",value:Number(m.price_baht)||0,onChange:e=>h(t=>({...t,price_baht:Number(e.target.value)})),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Max qty"}),(0,a.jsx)("input",{type:"number",value:null!==(t=m.max_quantity)&&void 0!==t?t:"",onChange:e=>h(t=>({...t,max_quantity:""===e.target.value?null:Number(e.target.value)})),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Active"}),(0,a.jsxs)("select",{value:m.active?"yes":"no",onChange:e=>h(t=>({...t,active:"yes"===e.target.value})),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900",children:[(0,a.jsx)("option",{value:"yes",children:"Yes"}),(0,a.jsx)("option",{value:"no",children:"No"})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:k,disabled:"new"===p,className:"px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:"new"===p?"Creating…":"Create"})})]}),(0,a.jsx)("div",{className:"border rounded overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left border-b",children:[(0,a.jsx)("th",{className:"p-2",children:"Name"}),(0,a.jsx)("th",{className:"p-2",children:"Price"}),(0,a.jsx)("th",{className:"p-2",children:"Qty"}),(0,a.jsx)("th",{className:"p-2",children:"# Issued"}),(0,a.jsx)("th",{className:"p-2",children:"# Paid"}),(0,a.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[o.map(e=>{var t,n;let r=j[e.id]||{issued:0,paid:0},i=g===e.id;return(0,a.jsx)("tr",{className:"border-b last:border-b-0",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{value:e.name||"",onChange:t=>_(e,{name:t.target.value}),disabled:r.issued>0,className:"w-full px-2 py-1 border rounded text-sm bg-white dark:bg-gray-900 disabled:opacity-60"})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{type:"number",value:Number(e.price_baht)||0,onChange:t=>_(e,{price_baht:Number(t.target.value)}),className:"w-full px-2 py-1 border rounded text-sm bg-white dark:bg-gray-900"})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{type:"number",value:null!==(n=e.max_quantity)&&void 0!==n?n:"",onChange:t=>_(e,{max_quantity:""===t.target.value?null:Number(t.target.value)}),className:"w-full px-2 py-1 border rounded text-sm bg-white dark:bg-gray-900"})}),(0,a.jsx)("td",{className:"p-2"}),(0,a.jsx)("td",{className:"p-2"}),(0,a.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,a.jsx)("button",{onClick:async()=>{let t=o.find(t=>t.id===e.id),n=null!=t.max_quantity?Number(t.max_quantity):null;if(null!=n&&n<r.issued){v("Max qty cannot be below issued (".concat(r.issued,")"));return}await T(t),f(null)},disabled:p===e.id,className:"px-2 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:p===e.id?"Saving…":"Save"}),(0,a.jsx)("button",{onClick:()=>{f(null),v("")},className:"px-2 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"p-2",children:e.name||"—"}),(0,a.jsx)("td",{className:"p-2",children:(0,s.dN)(Number(e.price_baht)||0,"THB")}),(0,a.jsx)("td",{className:"p-2",children:null!==(t=e.max_quantity)&&void 0!==t?t:"—"}),(0,a.jsx)("td",{className:"p-2",children:r.issued}),(0,a.jsx)("td",{className:"p-2",children:r.paid}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("button",{onClick:()=>f(e.id),className:"px-2 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:"Edit"})})]})},e.id)}),0===o.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"p-4 text-gray-500",colSpan:6,children:"No ticket types."})})]})]})})]})}},357:function(e,t,n){"use strict";var a,r;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,a,r=e.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o=[],l=!1,u=-1;function d(){l&&a&&(l=!1,a.length?o=a.concat(o):u=-1,o.length&&m())}function m(){if(!l){var e=c(d);l=!0;for(var t=o.length;t;){for(a=o,o=[];++u<t;)a&&a[u].run();u=-1,t=o.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}},s=!0;try{t[e](i,i.exports,a),s=!1}finally{s&&delete n[e]}return i.exports}a.ab="//";var r=a(229);e.exports=r}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return c}});var a=n(357);let r="/api",i=a.env.NEXT_PUBLIC_API_TOKEN;async function s(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};i&&(n["X-Auth-Token"]=i);let a=await fetch("".concat(r).concat(e),{headers:n,...t,cache:"no-store"});if(!a.ok){let e="".concat(a.status," ").concat(a.statusText);try{let t=await a.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==a.status)return a.json()}a.env.BACKEND_ORIGIN;let c={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>s("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>s("/events/".concat(e)),createEvent:e=>s("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>s("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>s("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>s("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>s("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>s("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>s("/events/".concat(e,"/purchases")),listAttendees:e=>s("/events/".concat(e,"/attendees")),getPurchase:e=>s("/purchases/".concat(e)),getPurchaseByGuid:e=>s("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>s("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>s("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return s("/contacts".concat(n))},getContact:e=>s("/contacts/".concat(e)),listContactPurchases:(e,t)=>s("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>s("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>s("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>s("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>s("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>s("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>s("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>s("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(r,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}},4621:function(e,t,n){"use strict";function a(e,t){if(null==e||isNaN(e))return"—";if("THB"===(t||"").toUpperCase()){var n;return null==(n=Number(e))||isNaN(n)?"-":new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",maximumFractionDigits:0}).format(Number(n))}let a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Number(e));return t?"".concat(a," ").concat(t):a}function r(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let n=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getFullYear()).slice(-2);return"".concat(n,"/").concat(a,"/").concat(r)}n.d(t,{GZ:function(){return r},dN:function(){return a}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=9414)}),_N_E=e.O()}]);