(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{5371:function(e,t,n){Promise.resolve().then(n.bind(n,611)),Promise.resolve().then(n.bind(n,5743))},611:function(e,t,n){"use strict";n.d(t,{default:function(){return s}});var r=n(7437),c=n(2265),o=n(1013),a=n(4621);function s(e){let{purchase:t}=e,[n,s]=(0,c.useState)(!1),[i,l]=(0,c.useState)(!1),[u,d]=(0,c.useState)(""),[m,h]=(0,c.useState)(Date.now());(0,c.useEffect)(()=>{let e=setInterval(()=>h(Date.now()),1e3);return()=>clearInterval(e)},[]);let f=(0,c.useMemo)(()=>{let e=new Map;for(let n of t.tickets||[]){let t="".concat(n.type_name||n.type_id,"-").concat(n.price_baht||0),r=e.get(t)||{name:n.type_name||"Type #".concat(n.type_id),price:n.price_baht||0,qty:0,subtotal:0};r.qty+=1,r.subtotal+=r.price,e.set(t,r)}return Array.from(e.values())},[t]),p=(0,c.useMemo)(()=>"number"==typeof t.total_amount?t.total_amount:"number"==typeof t.sum_price?t.sum_price:f.reduce((e,t)=>e+t.subtotal,0),[t,f]),y=t.currency||"THB",v=(0,c.useMemo)(()=>{let e=t.created_at?new Date(t.created_at).getTime():0,n=e?e+864e5:0,r=Math.max(0,Math.floor((n-m)/1e3)),c=Math.floor(r/86400);return n?"".concat(c>0?c+"d ":"").concat(Math.floor(r%86400/3600),"h ").concat(Math.floor(r%3600/60),"m"):""},[t,m]);async function g(){try{s(!0),d(""),await o.h.payPurchase(t.id),l(!0)}catch(e){d((null==e?void 0:e.message)||"Payment failed")}finally{s(!1)}}return(0,r.jsx)("div",{className:"space-y-3",children:i?(0,r.jsx)("div",{className:"p-4 border rounded text-sm",children:"Payment successful. Tickets will arrive by email shortly."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Reservation expires in ",v]}),(0,r.jsx)("div",{className:"border rounded",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-left border-b",children:[(0,r.jsx)("th",{className:"p-2",children:"Item"}),(0,r.jsx)("th",{className:"p-2",children:"Qty"}),(0,r.jsx)("th",{className:"p-2",children:"Price"}),(0,r.jsx)("th",{className:"p-2",children:"Subtotal"})]})}),(0,r.jsx)("tbody",{children:f.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,r.jsx)("td",{className:"p-2",children:e.name}),(0,r.jsx)("td",{className:"p-2",children:e.qty}),(0,r.jsx)("td",{className:"p-2",children:(0,a.dN)(e.price,y)}),(0,r.jsx)("td",{className:"p-2",children:(0,a.dN)(e.subtotal,y)})]},t))})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-base font-medium",children:["Total: ",(0,a.dN)(p,y)]}),(0,r.jsx)("button",{onClick:g,disabled:n,className:"px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:n?"Paying…":"Pay now"})]}),u&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:u})]})})}},5743:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n(7437),c=n(2265),o=n(1013);function a(e){let{token:t,ticket:n}=e,[a,s]=(0,c.useState)(!1),[i,l]=(0,c.useState)(!1),[u,d]=(0,c.useState)("");async function m(){try{s(!0),d(""),await o.h.payByToken(t),l(!0)}catch(e){d((null==e?void 0:e.message)||"Payment failed")}finally{s(!1)}}return(0,r.jsx)("div",{className:"space-y-3",children:i?(0,r.jsx)("div",{className:"p-4 border rounded text-sm",children:"Payment successful. Ticket will arrive by email shortly."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-sm",children:["Ticket: ",(null==n?void 0:n.type_name)||(null==n?void 0:n.type_id)||"—"]}),(0,r.jsx)("button",{onClick:m,disabled:a,className:"px-3 py-2 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-800",children:a?"Paying…":"Pay now"}),u&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:u})]})})}},357:function(e,t,n){"use strict";var r,c;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(c=n.g.process)?void 0:c.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,c=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var i=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?i=r.concat(i):u=-1,i.length&&m())}function m(){if(!l){var e=s(d);l=!0;for(var t=i.length;t;){for(r=i,i=[];++u<t;)r&&r[u].run();u=-1,t=i.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}c.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new h(e,t)),1!==i.length||l||s(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=f,c.addListener=f,c.once=f,c.off=f,c.removeListener=f,c.removeAllListeners=f,c.emit=f,c.prependListener=f,c.prependOnceListener=f,c.listeners=function(e){return[]},c.binding=function(e){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw Error("process.chdir is not supported")},c.umask=function(){return 0}}},n={};function r(e){var c=n[e];if(void 0!==c)return c.exports;var o=n[e]={exports:{}},a=!0;try{t[e](o,o.exports,r),a=!1}finally{a&&delete n[e]}return o.exports}r.ab="//";var c=r(229);e.exports=c}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var r=n(357);let c="/api",o=r.env.NEXT_PUBLIC_API_TOKEN;async function a(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};o&&(n["X-Auth-Token"]=o);let r=await fetch("".concat(c).concat(e),{headers:n,...t,cache:"no-store"});if(!r.ok){let e="".concat(r.status," ").concat(r.statusText);try{let t=await r.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==r.status)return r.json()}r.env.BACKEND_ORIGIN;let s={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>a("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>a("/events/".concat(e)),createEvent:e=>a("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>a("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>a("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>a("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>a("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>a("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>a("/events/".concat(e,"/purchases")),listAttendees:e=>a("/events/".concat(e,"/attendees")),getPurchase:e=>a("/purchases/".concat(e)),getPurchaseByGuid:e=>a("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>a("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>a("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return a("/contacts".concat(n))},getContact:e=>a("/contacts/".concat(e)),listContactPurchases:(e,t)=>a("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>a("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>a("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>a("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>a("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>a("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>a("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>a("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(c,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}},4621:function(e,t,n){"use strict";function r(e,t){if(null==e||isNaN(e))return"—";if("THB"===(t||"").toUpperCase()){var n;return null==(n=Number(e))||isNaN(n)?"-":new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",maximumFractionDigits:0}).format(Number(n))}let r=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Number(e));return t?"".concat(r," ").concat(t):r}function c(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let n=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getFullYear()).slice(-2);return"".concat(n,"/").concat(r,"/").concat(c)}n.d(t,{GZ:function(){return c},dN:function(){return r}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=5371)}),_N_E=e.O()}]);