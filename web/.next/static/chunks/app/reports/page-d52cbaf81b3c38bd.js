(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{4116:function(e,t,n){Promise.resolve().then(n.bind(n,7726))},7726:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var c=n(7437),o=n(2265),a=n(1013);function r(){let[e,t]=(0,o.useState)(""),[n,r]=(0,o.useState)(null),[i,l]=(0,o.useState)(""),[u,d]=(0,o.useState)([]),[h,f]=(0,o.useState)(!1),[v,m]=(0,o.useState)("active");(0,o.useEffect)(()=>{(async()=>{f(!0),l("");try{let e=[],t=0;for(;;){let n=await a.h.listEvents(200,t);if(e=e.concat(n),n.length<200)break;t+=200}d(e)}catch(e){l(e.message||"Failed to load events")}finally{f(!1)}})()},[]);let p=(0,o.useMemo)(()=>{if("all"===v)return u;let e=new Date;return u.filter(t=>{let n=t.starts_at?new Date(t.starts_at):null,c=t.ends_at?new Date(t.ends_at):null;return c?c>=e:!!n&&n>=e})},[u,v]);async function g(){if(e){l("");try{r(await a.h.reconciliation(Number(e)))}catch(e){l(e.message)}}}return(0,c.jsxs)("section",{className:"space-y-4",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold",children:"Reports"}),(0,c.jsxs)("div",{className:"flex flex-nowrap items-center gap-2",children:[(0,c.jsxs)("select",{value:v,onChange:e=>m(e.target.value),className:"px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900",children:[(0,c.jsx)("option",{value:"active",children:"Active events"}),(0,c.jsx)("option",{value:"all",children:"All events"})]}),(0,c.jsx)("div",{className:"flex-1 min-w-0",children:(0,c.jsxs)("select",{value:e?String(e):"",onChange:e=>t(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border rounded text-sm bg-white dark:bg-gray-900",children:[(0,c.jsx)("option",{value:"",children:h?"Loading…":"Select event…"}),p.map(e=>(0,c.jsxs)("option",{value:String(e.id),children:["#",e.id," • ",e.title]},e.id))]})}),(0,c.jsx)("button",{onClick:g,disabled:!e,className:"px-3 py-2 border rounded text-sm whitespace-nowrap",children:"Load"})]}),i&&(0,c.jsx)("p",{className:"text-sm text-red-600",children:i}),n&&(0,c.jsx)(s,{summary:n})]})}function s(e){var t;let{summary:n}=e,o=n.event||{},a=o.starts_at?new Date(o.starts_at):null,r=o.ends_at?new Date(o.ends_at):null,s=new Date,u=a?l(s,a):"—",d=r?r>s?"Ends in ".concat(l(s,r)):"Ended ".concat(l(r,s)," ago"):"—",h=null!==(t=n.registered)&&void 0!==t?t:(n.assigned||0)+(n.delivered||0)+(n.checked_in||0),f=n.checked_in||0,v="number"==typeof n.revenue_baht?n.revenue_baht:0;return(0,c.jsxs)("div",{className:"border rounded p-4 mt-2",children:[(0,c.jsx)("div",{className:"font-semibold mb-2",children:o.title||"Event"}),(0,c.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,c.jsx)(i,{label:"Time until start",value:u}),(0,c.jsx)(i,{label:"Event end",value:d}),(0,c.jsx)(i,{label:"Registered",value:String(h)}),(0,c.jsx)(i,{label:"Attended",value:String(f)}),(0,c.jsx)(i,{label:"Attendance rate",value:h>0?"".concat(Math.round(f/h*100),"%"):"0%"}),(0,c.jsx)(i,{label:"Revenue (THB)",value:String(v)})]})]})}function i(e){let{label:t,value:n}=e;return(0,c.jsxs)("div",{className:"border rounded p-3",children:[(0,c.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:t}),(0,c.jsx)("div",{className:"text-lg font-medium",children:n})]})}function l(e,t){let n=Math.floor(Math.abs(t.getTime()-e.getTime())/6e4),c=Math.floor(n/60),o=Math.floor(c/24);return o>0?"".concat(o,"d ").concat(c%24,"h"):c>0?"".concat(c,"h ").concat(n%60,"m"):"".concat(n,"m")}},357:function(e,t,n){"use strict";var c,o;e.exports=(null==(c=n.g.process)?void 0:c.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,c,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var i=[],l=!1,u=-1;function d(){l&&c&&(l=!1,c.length?i=c.concat(i):u=-1,i.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=i.length;t;){for(c=i,i=[];++u<t;)c&&c[u].run();u=-1,t=i.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new f(e,t)),1!==i.length||l||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function c(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}},r=!0;try{t[e](a,a.exports,c),r=!1}finally{r&&delete n[e]}return a.exports}c.ab="//";var o=c(229);e.exports=o}()},1013:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var c=n(357);let o="/api",a=c.env.NEXT_PUBLIC_API_TOKEN;async function r(e,t){let n={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};a&&(n["X-Auth-Token"]=a);let c=await fetch("".concat(o).concat(e),{headers:n,...t,cache:"no-store"});if(!c.ok){let e="".concat(c.status," ").concat(c.statusText);try{let t=await c.json();(null==t?void 0:t.detail)&&(e=Array.isArray(t.detail)?t.detail.map(e=>e.msg||e).join(", "):t.detail)}catch(e){}throw Error(e)}if(204!==c.status)return c.json()}c.env.BACKEND_ORIGIN;let s={listEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r("/events?limit=".concat(e,"&offset=").concat(t))},resolveEvent:e=>r("/events/public/".concat(encodeURIComponent(e))),getEvent:e=>r("/events/".concat(e)),createEvent:e=>r("/events",{method:"POST",body:JSON.stringify(e)}),updateEvent:(e,t)=>r("/events/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),listTicketTypes:e=>r("/events/".concat(e,"/ticket_types")),createTicketType:(e,t)=>r("/events/".concat(e,"/ticket_types"),{method:"POST",body:JSON.stringify(t)}),updateTicketType:(e,t)=>r("/events/ticket_types/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),reconciliation:e=>r("/reports/reconciliation?event_id=".concat(e)),listEventPurchases:e=>r("/events/".concat(e,"/purchases")),listAttendees:e=>r("/events/".concat(e,"/attendees")),getPurchase:e=>r("/purchases/".concat(e)),getPurchaseByGuid:e=>r("/purchases/by-guid/".concat(encodeURIComponent(e))),payPurchase:e=>r("/purchases/".concat(e,"/pay"),{method:"POST"}),resendPurchasePayment:e=>r("/purchases/".concat(e,"/resend_payment"),{method:"POST"}),listContacts:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.roles)&&t.set("roles",e.roles),(null==e?void 0:e.limit)!=null&&t.set("limit",String(e.limit)),(null==e?void 0:e.offset)!=null&&t.set("offset",String(e.offset));let n=t.toString()?"?".concat(t.toString()):"";return r("/contacts".concat(n))},getContact:e=>r("/contacts/".concat(e)),listContactPurchases:(e,t)=>r("/contacts/".concat(e,"/purchases").concat(t?"?event_id=".concat(t):"")),listHolderTickets:e=>r("/contacts/".concat(e,"/holder_tickets")),ticketByCode:e=>r("/tickets/by-code/".concat(encodeURIComponent(e))),ticketByToken:e=>r("/tickets/by-token/".concat(encodeURIComponent(e))),payByToken:e=>r("/tickets/pay",{method:"POST",body:JSON.stringify({token:e})}),lookupTicket:(e,t)=>r("/tickets/lookup?code=".concat(encodeURIComponent(e)).concat(t?"&event_id=".concat(t):"")),checkin:(e,t)=>r("/checkin",{method:"POST",body:JSON.stringify({event_id:e,code:t})}),listEmailLogs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r("/admin/email_logs?limit=".concat(e,"&offset=").concat(t))},sendTestEmail:e=>r("/test_email?to=".concat(encodeURIComponent(e)),{method:"POST"}),qrUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"".concat(o,"/qr?data=").concat(encodeURIComponent(e),"&scale=").concat(t)}}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=4116)}),_N_E=e.O()}]);